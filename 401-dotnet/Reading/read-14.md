# Read: Intro to APIs

- [Data Seeding](https://docs.microsoft.com/en-us/ef/core/modeling/data-seeding)
- [Entity Framework Core](https://docs.microsoft.com/en-us/aspnet/core/data/ef-rp/intro?view=aspnetcore-2.1&tabs=visual-studio)
- [YouTube - Intro to APIs (60 min)](https://www.youtube.com/watch?v=aIkpVzqLuhA&feature=youtu.be)

---

## Data Seeding
- Data seeding is the process of populating ad db with an initial set of data
- How to in EF Core:
    - Model Seed Data
    - Manual migration customization
    - Custom initialization logic

### Model Seed Data
- Seeding data can be associated with and entity type.
    - `modelBuilder.Entity<Blog>().HasData(new Blog {BlogId = 1, Url = "http://sample.com"});`
- once the data has been added, migrations should be used to apply the changes.
- Alternatively, use `context.Database.EnsureCreated()`to create a new db containing the seed data.
    - if db already exists `EnsureCreated()` will neither update the schema nor seed data in the db. 
    - don't use EnsureCreated() on relational dbs if you plan to use migrations.
- Limitations
    - The primary key value needs to be specified even if it's usually generated by the db. 
    - Previously seeded data will be removed if the primary key is changed in any way.

### Manual migration customization
``` CSharp
migrationBuilder.InsertData(
    table: "Blogs",
    columns: new[] { "Url" },
    values: new object[] { "http://generated.com" });
```
### Custom initialization Logic
- `DBContext.SaveChanges()` 
```CSharp
using (var context = new DataSeedingContext())
{
    context.Database.EnsureCreated();

    var testBlog = context.Blogs.FirstOrDefault(b => b.Url == "http://test.com");
    if (testBlog == null)
    {
        context.Blogs.Add(new Blog { Url = "http://test.com" });
    }
    context.SaveChanges();
}
```
- Ways of executing
    - Running the initialization app locally
    - Deploying the initialization app with the main app, invoking the initialization routine and disabling or removing the initialization app.
